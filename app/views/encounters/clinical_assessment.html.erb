<script type="text/javascript" type="text/javascript" src="/assets/jquery.js"></script>
<script type="text/javascript" type="text/javascript" src="/assets/top-icon.js"></script>

<script>

    var tt_cancel_destination = "/patient/dashboard/<%= @patient_obj.patient_id %>/tasks";

    var group;
    var clinical_questions = <%= raw (@clinical_questions).to_json%>;
    var initial_questions = clinical_questions['<%= @group %>'];

    console.log(clinical_questions);

    function setGroup() {
        group = $('touchscreenInput'+tstCurrentPage).value;
    }

    function getGroup() {
        var selected_group = group;
    }
</script>

<%= form_tag("/encounters/create", id: "clinical_assessment", method: 'post', enctype: 'multipart/form-data') do %>
    <%= hidden_field_tag "encounter[encounter_type]", EncounterType.find_by_name("CLINICAL ASSESSMENT").id %>
    <%= hidden_field_tag "encounter[patient_id]", @patient_obj.patient_id %>
    <%= hidden_field_tag "encounter[encounter_datetime]", (session_date || DateTime.now()).to_s(:db) %>
    <%= hidden_field_tag "encounter[provider_id]", session[:user_id] %>

    <% @current_data = Encounter.current_data("CLINICAL ASSESSMENT", @patient_obj.patient_id)%>

    <%= select_tag 'observations[][value_coded_or_text]',
                   options_for_select(['',
                                       'Group 1',
                                       'Group 2',
                                       'Group 3',
                                       'Group 4',
                                       'Group 5',
                                       'Group 6',
                                       'Group 7'],
                                      @group),
                   :helpText =>'Target group',
                   :tt_onLoad => "showHelpButton();$('keyboard').style.display = 'none' ",
                   :tt_onUnLoad => 'hideHelpButton();setGroup();',
                   :tt_pageStyleClass => 'longSelectList',
                   :id => 'clinical_question',
                   :allowFreeText => false
    %>

    <% @clinical_questions.each do |group, clinical_questions| %>
        <% clinical_questions.each do | clinical_question| %>
        <%= hidden_field_tag('observations[][concept_name]', "#{clinical_question}") %>
        <%= select_tag 'observations[][value_coded_or_text]',
                       options_for_select(['',
                                           'Yes',
                                           'No'] ,
                                          @current_data['CLINICAL ASSESSMENT']),
                       :helpText =>"#{clinical_question}",
                       :tt_onLoad => "showHelpButton();getGroup();$('keyboard').style.display = 'none'",
                       :tt_onUnLoad => 'hideHelpButton();',
                       :condition => "'#{group}'.match(group)",
                       :id => "#{clinical_question}",
                       :allowFreeText => false
        %>

        <%#= hidden_field_tag("observations[][concept_name]", "concept_name_2") %>
        <%#= select_tag "observations[][value_coded_or_text]", options_for_select(['','Yes','No'] , @current_data['CLINICAL ASSESSMENT']),
                       :helpText =>'Another Question comes here.',
                       :condition => "$('clinical_question').value == 'Yes';",
                       :tt_onLoad => 'showHelpButton();',
                       :tt_onUnLoad => 'hideHelpButton();',
                       :id => 'clinical_assessment',
                       :allowFreeText => false
        %>
    <% end %>
    <% end %>
<% end %>